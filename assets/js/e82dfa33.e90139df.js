(self.webpackChunkzxuqian_cn=self.webpackChunkzxuqian_cn||[]).push([[34],{2122:function(e,n,t){"use strict";function r(){return(r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}t.d(n,{Z:function(){return r}})},9756:function(e,n,t){"use strict";function r(e,n){if(null==e)return{};var t,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}t.d(n,{Z:function(){return r}})},3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return u},kt:function(){return f}});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),d=c(t),f=o,m=d["".concat(l,".").concat(f)]||d[f]||p[f]||s;return t?r.createElement(m,i(i({ref:n},u),{},{components:t})):r.createElement(m,i({ref:n},u))}));function f(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=t.length,i=new Array(s);i[0]=d;var a={};for(var l in n)hasOwnProperty.call(n,l)&&(a[l]=n[l]);a.originalType=e,a.mdxType="string"==typeof e?e:o,i[1]=a;for(var c=2;c<s;c++)i[c]=t[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},1455:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return a},metadata:function(){return l},toc:function(){return c},default:function(){return p}});var r=t(2122),o=t(9756),s=(t(7294),t(3905)),i={title:"\u624b\u5199 Promise",date:new Date("2019-01-13T00:00:00.000Z"),sidebar:"auto",categories:["\u524d\u7aef\u57fa\u7840"],tags:["Promise"],publish:!0,sticky:3,showSponsor:!0},a=void 0,l={unversionedId:"skill/es6/promise/promise4",id:"skill/es6/promise/promise4",isDocsHomePage:!1,title:"\u624b\u5199 Promise",description:"\u6700\u7b80\u5355\u7684Promise\u5b9e\u73b0\u67097\u4e2a\u4e3b\u8981\u5c5e\u6027, state(\u72b6\u6001), value(\u6210\u529f\u8fd4\u56de\u503c), reason(\u9519\u8bef\u4fe1\u606f), resolve\u65b9\u6cd5, reject\u65b9\u6cd5, then\u65b9\u6cd5,catch\u65b9\u6cd5.",source:"@site/docs/skill/es6/promise/promise4.md",sourceDirName:"skill/es6/promise",slug:"/skill/es6/promise/promise4",permalink:"/docs/skill/es6/promise/promise4",version:"current",frontMatter:{title:"\u624b\u5199 Promise",date:"2019-01-13T00:00:00.000Z",sidebar:"auto",categories:["\u524d\u7aef\u57fa\u7840"],tags:["Promise"],publish:!0,sticky:3,showSponsor:!0},sidebar:"skill",previous:{title:"Promise \u9ad8\u7ea7",permalink:"/docs/skill/es6/promise/promise3"},next:{title:"async await",permalink:"/docs/skill/es6/promise/async"}},c=[{value:"\u9762\u8bd5\u591f\u7528\u7248 Promise",id:"\u9762\u8bd5\u591f\u7528\u7248-promise",children:[]},{value:"\u5927\u5382\u4e13\u4f9b\u7248",id:"\u5927\u5382\u4e13\u4f9b\u7248",children:[]}],u={toc:c};function p(e){var n=e.components,t=(0,o.Z)(e,["components"]);return(0,s.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"\u6700\u7b80\u5355\u7684",(0,s.kt)("inlineCode",{parentName:"p"},"Promise"),"\u5b9e\u73b0\u67097\u4e2a\u4e3b\u8981\u5c5e\u6027, ",(0,s.kt)("inlineCode",{parentName:"p"},"state"),"(\u72b6\u6001), ",(0,s.kt)("inlineCode",{parentName:"p"},"value"),"(\u6210\u529f\u8fd4\u56de\u503c), ",(0,s.kt)("inlineCode",{parentName:"p"},"reason"),"(\u9519\u8bef\u4fe1\u606f), ",(0,s.kt)("inlineCode",{parentName:"p"},"resolve"),"\u65b9\u6cd5, ",(0,s.kt)("inlineCode",{parentName:"p"},"reject"),"\u65b9\u6cd5, ",(0,s.kt)("inlineCode",{parentName:"p"},"then"),"\u65b9\u6cd5,",(0,s.kt)("inlineCode",{parentName:"p"},"catch"),"\u65b9\u6cd5."),(0,s.kt)("h2",{id:"\u9762\u8bd5\u591f\u7528\u7248-promise"},"\u9762\u8bd5\u591f\u7528\u7248 Promise"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'// \u5b9a\u4e49\u72b6\u6001\nconst PENDING = "pending";\nconst FULFILLED = "fulfilled";\nconst REJECTED = "rejected";\n// Promise\u6784\u9020\u51fd\u6570\nfunction MyPromise(fn) {\n    let _this = this;//\u7528_this\u4fdd\u5b58this\uff0c\u907f\u514d\u540e\u671f\u95ed\u5305\u5bfc\u81f4this\u7684\u6307\u5411\u4e0d\u5bf9\n    _this.value = undefined; //\u5b9a\u4e49\u72b6\u6001\u4e3aresolved\u7684\u65f6\u7684\u72b6\u6001\n    _this.reason = undefined; //\u5b9a\u4e49\u72b6\u6001\u4e3arejected\u7684\u65f6\u7684\u72b6\u6001\n    _this.status = PENDING; //\u5b9a\u4e49\u72b6\u6001\u6539\u53d8\u524d\u7684\u521d\u59cb\u72b6\u6001\n        //\u4e24\u4e2a==="pending"\uff0c\u4fdd\u8bc1\u4e86\u72b6\u6001\u7684\u6539\u53d8\u662f\u4e0d\u4e0d\u53ef\u9006\u7684\n    function resolve(value) {\n        if (_this.status === PENDING) {\n            _this.status = FULFILLED;\n            _this.value = value;\n        }\n    }\n    function reject(reason) {\n        if (_this.status === PENDING) {\n            _this.status = REJECTED;\n            _this.reason = reason;\n        }\n    }\n    //\u6355\u83b7\u6784\u9020\u5f02\u5e38\n    try {\n        fn(resolve, reject);\n    } catch (error) {\n        reject(error);\n    }\n}\n// \u5b9a\u4e49\u539f\u578b\u4e2d\u7684 then \u51fd\u6570\nMyPromise.prototype.then = function(onFulfilled, onRejected) {\n    let _this = this;\n    switch (_this.status) {\n        case "fulfilled":\n            onFulfilled(_this.value);\n            break;\n        case "rejected":\n            onRejected(_this.reason);\n            break;\n        default:\n    }\n};\n// \u6d4b\u8bd5\nvar a = new MyPromise(function(resolve, reject) {\n    resolve(1);\n});\na.then(console.log);\n//\u8f93\u51fa1\n')),(0,s.kt)("h2",{id:"\u5927\u5382\u4e13\u4f9b\u7248"},"\u5927\u5382\u4e13\u4f9b\u7248"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'const PENDING = "pending";\nconst FULFILLED = "fulfilled";\nconst REJECTED = "rejected";\nfunction Promise(excutor) {\n  let that = this; // \u7f13\u5b58\u5f53\u524dpromise\u5b9e\u4f8b\u4f8b\u5bf9\u8c61\n  that.status = PENDING; // \u521d\u59cb\u72b6\u6001\n  that.value = undefined; // fulfilled\u72b6\u6001\u65f6 \u8fd4\u56de\u7684\u4fe1\u606f\n  that.reason = undefined; // rejected\u72b6\u6001\u65f6 \u62d2\u7edd\u7684\u539f\u56e0\n  that.onFulfilledCallbacks = []; // \u5b58\u50a8fulfilled\u72b6\u6001\u5bf9\u5e94\u7684onFulfilled\u51fd\u6570\n  that.onRejectedCallbacks = []; // \u5b58\u50a8rejected\u72b6\u6001\u5bf9\u5e94\u7684onRejected\u51fd\u6570\n  function resolve(value) { // value\u6210\u529f\u6001\u65f6\u63a5\u6536\u7684\u7ec8\u503c\n    if(value instanceof Promise) {\n      return value.then(resolve, reject);\n    }\n    // \u5b9e\u8df5\u4e2d\u8981\u786e\u4fdd onFulfilled \u548c onRejected \u2f45\u65b9\u6cd5\u5f02\u6b65\u6267\u2f8f\u884c\u884c\uff0c\u4e14\u5e94\u8be5\u5728 then \u2f45\u65b9\u6cd5\u88ab\u8c03\u2f64\u7528\u7684\u90a3\u2f00\u4e00\u8f6e\u4e8b\u4ef6\u5faa\u73af\u4e4b\u540e\u7684\u65b0\u6267\u2f8f\u884c\u884c\u6808\u4e2d\u6267\u2f8f\u884c\u884c\u3002\n    setTimeout(() => {\n      // \u8c03\u2f64\u7528resolve \u56de\u8c03\u5bf9\u5e94onFulfilled\u51fd\u6570\n      if (that.status === PENDING) {\n        // \u53ea\u80fd\u7531pending\u72b6\u6001 => fulfilled\u72b6\u6001 (\u907f\u514d\u8c03\u2f64\u7528\u591a\u6b21resolve reject)\n        that.status = FULFILLED;\n        that.value = value;\n        that.onFulfilledCallbacks.forEach(cb => cb(that.value));\n      }\n    });\n  }\n  function reject(reason) { // reason\u5931\u8d25\u6001\u65f6\u63a5\u6536\u7684\u62d2\u56e0\n    setTimeout(() => {\n      // \u8c03\u2f64\u7528reject \u56de\u8c03\u5bf9\u5e94onRejected\u51fd\u6570\n      if (that.status === PENDING) {\n        // \u53ea\u80fd\u7531pending\u72b6\u6001 => rejected\u72b6\u6001 (\u907f\u514d\u8c03\u2f64\u7528\u591a\u6b21resolve reject)\n        that.status = REJECTED;\n        that.reason = reason;\n        that.onRejectedCallbacks.forEach(cb => cb(that.reason));\n      }\n    });\n  }\n\n  // \u6355\u83b7\u5728excutor\u6267\u2f8f\u884c\u884c\u5668\u5668\u4e2d\u629b\u51fa\u7684\u5f02\u5e38\n  // new Promise((resolve, reject) => {\n  //     throw new Error(\'error in excutor\')\n  // })\n  try {\n    excutor(resolve, reject);\n  } catch (e) {\n    reject(e);\n  }\n}\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  const that = this;\n  let newPromise;\n  // \u5904\u7406\u7406\u53c2\u6570\u9ed8\u8ba4\u503c \u4fdd\u8bc1\u53c2\u6570\u540e\u7eed\u80fd\u591f\u7ee7\u7eed\u6267\u2f8f\u884c\u884c\n  onFulfilled = typeof onFulfilled === "function" ? onFulfilled : value => value;\n  onRejected = typeof onRejected === "function" ? onRejected : reason => {\n    throw reason;\n  };\n  if (that.status === FULFILLED) { // \u6210\u529f\u6001\n    return newPromise = new Promise((resolve, reject) => {\n      setTimeout(() => {\n        try{\n          let x = onFulfilled(that.value);\n          resolvePromise(newPromise, x, resolve, reject); //\u65b0\u7684promise resolve \u4e0a\u2f00\u4e00\u4e2aonFulfilled\u7684\u8fd4\u56de\u503c\n        } catch(e) {\n          reject(e); // \u6355\u83b7\u524d\u2faf\u9762onFulfilled\u4e2d\u629b\u51fa\u7684\u5f02\u5e38then(onFulfilled, onRejected);\n        }\n      });\n    })\n  }\n  if (that.status === REJECTED) { // \u5931\u8d25\u6001\n    return newPromise = new Promise((resolve, reject) => {\n      setTimeout(() => {\n        try {\n          let x = onRejected(that.reason);\n          resolvePromise(newPromise, x, resolve, reject);\n        } catch(e) {\n          reject(e);\n        }\n      });\n    });\n  }\n  if (that.status === PENDING) { // \u7b49\u5f85\u6001\n// \u5f53\u5f02\u6b65\u8c03\u2f64\u7528resolve/rejected\u65f6 \u5c06onFulfilled/onRejected\u6536\u96c6\u6682\u5b58\u5230\u96c6\u5408\u4e2d\n    return newPromise = new Promise((resolve, reject) => {\n      that.onFulfilledCallbacks.push((value) => {\n        try {\n          let x = onFulfilled(value);\n          resolvePromise(newPromise, x, resolve, reject);\n        } catch(e) {\n          reject(e);\n        }\n      });\n      that.onRejectedCallbacks.push((reason) => {\n        try {\n          let x = onRejected(reason);\n          resolvePromise(newPromise, x, resolve, reject);\n        } catch(e) {\n          reject(e);\n        }\n      });\n    });\n  }\n};\n')),(0,s.kt)("span",null,"\n    ",(0,s.kt)("ins",{parentName:"span",className:"adsbygoogle",style:{display:"block",textAlign:"center"},"data-ad-layout":"in-article","data-ad-format":"fluid","data-ad-client":"ca-pub-3487507367729662","data-ad-slot":"1964508460"}),"\n  ",(0,s.kt)("script",{parentName:"span"},"\n     (adsbygoogle = window.adsbygoogle || []).push({});\n  ")))}p.isMDXComponent=!0}}]);