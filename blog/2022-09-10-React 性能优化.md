---
slug: "/react-performance"
layout: Post
title: React æ€§èƒ½ä¼˜åŒ– # åšå®¢æ ‡é¢˜ï¼ˆå¿…é¡»ï¼‰
date: 2022-09-10 # åšå®¢æ—¥æœŸï¼Œä¼šæ˜¾ç¤ºåœ¨æ–‡ç« å¤´éƒ¨ï¼ˆå¯é€‰ï¼‰
author: Lucas
author_title: ä¸€æšå°å‰ç«¯
author_url: https://github.com/ihoneys
author_image_url: /img/ihoneys.png
catalog: true # æ˜¯å¦å¯ç”¨å³ä¾§ç›®å½•ï¼šfalse / trueï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º falseï¼‰
tags: [React, æ€§èƒ½ä¼˜åŒ–]
---

# React æ€§èƒ½ä¼˜åŒ–

## å‰è¨€

æƒ³è¦å†™å‡ºé«˜è´¨é‡çš„ä»£ç ï¼Œä»…ä»…é æ¡†æ¶åº•å±‚å¸®æˆ‘ä»¬çš„ä¼˜åŒ–è¿˜è¿œè¿œä¸å¤Ÿï¼Œåœ¨ç¼–å†™çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å»ä½¿ç”¨æé«˜çš„ apiï¼Œæˆ–è€…æ ¹æ®å®ƒåº•å±‚çš„åŸç†å»åšä¸€äº›ä¼˜åŒ–ï¼Œä»¥åŠè§„èŒƒã€‚

ç›¸æ¯”äº Vue ï¼ŒReact ä¸ä¼šå†æ¡†æ¶æºç å±‚é¢å¸®åŠ©æˆ‘ä»¬ç›´æ¥è§£å†³ä¸€ä¸‹åŸºæœ¬çš„æ€§èƒ½ä¼˜åŒ–ç›¸å…³ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸‹ API ï¼ˆHooksï¼‰è®©æˆ‘ä»¬è‡ªå·±å»ä¼˜åŒ–æˆ‘ä»¬çš„åº”ç”¨ï¼Œä¹Ÿæ˜¯å®ƒè‡ªèº«æ›´çµæ´»çš„ä¸€ç§åŸå› ä¹‹ä¸€ã€‚

ä¸‹é¢æ€»ç»“äº†ä¸€äº›ä»ç¼–å†™ React ä»£ç å±‚é¢ä¸Šèƒ½åšçš„ä¼˜åŒ–ç‚¹ã€‚

<!--truncate-->

## éå†è§†å›¾ key ä½¿ç”¨

key çš„ä½œç”¨èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è¯†åˆ«å“ªäº›å…ƒç´ æ”¹å˜äº†ï¼Œæ¯”å¦‚æ·»åŠ å’Œåˆ é™¤ã€‚åœ¨ React æ›´æ–°æ—¶ï¼Œä¼šè§¦å‘ React Diff ç®—æ³•ï¼Œdiff è¿‡ç¨‹ä¸­è¿‡å€ŸåŠ© key å€¼æ¥åˆ¤æ–­å…ƒç´ æ˜¯æ–°åˆ›å»ºè¿˜æ˜¯éœ€è¦ç§»åŠ¨çš„å…ƒç´ ã€‚React ä¼šä¿å­˜è¿™ä¸ªè¾…åŠ©çŠ¶æ€ã€‚ä»è€Œå‡å°‘ä¸å¿…è¦çš„å…ƒç´ æ¸²æŸ“ã€‚

key çš„å€¼æœ€å¥½æ˜¯å½“å‰åˆ—è¡¨ä¸­æ‹¥æœ‰ç‹¬ä¸€æ— äºŒçš„å­—ç¬¦ä¸²ã€‚å¼€å‘ä¸­é€šå¸¸ç”¨ id ç­‰è¿™äº›ä½œä¸ºå…ƒç´ çš„ key å€¼ã€‚

å½“å‰çš„åˆ—è¡¨ä¸ä¼šå‘ç”Ÿæ“ä½œï¼Œä¸‡ä¸å¾—å·² å¯ä»¥ä½¿ç”¨ index ä½œä¸º key å€¼ã€‚

key åº”è¯¥å…·æœ‰ç¨³å®šï¼Œå¯é¢„æµ‹ï¼Œä»¥åŠåˆ—è¡¨å†…å”¯ä¸€çš„ç‰¹è´¨ã€‚ä¸ç¨³å®šçš„ key æ¯”å¦‚ Math.random() ç”Ÿæˆçš„ä¼š å¯¼è‡´å¾ˆå¤šç»„ä»¶å®ä¾‹å’Œ DOM èŠ‚ç‚¹è¢«ä¸å¿…è¦çš„é‡æ–°åˆ›å»ºï¼Œè¿™å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™å’Œå­ç»„ä»¶çŠ¶æ€ä¸¢å¤±ç­‰ç­‰ã€‚

## React.memo ç¼“å­˜ç»„ä»¶

react æ˜¯å•å‘æ•°æ®æµï¼Œçˆ¶ç»„ä»¶çŠ¶æ€çš„æ›´æ–°ä¹Ÿä¼šè®©å­ç»„ä»¶ä¸€èµ·é‡æ–°æ¸²æŸ“æ›´æ–°ï¼Œå³ä½¿å­ç»„ä»¶çš„çŠ¶æ€æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä¸ä¼šåƒ Vue ä¸€æ ·èƒ½å¤Ÿå…·ä½“ç›‘å¬åˆ°æŸä¸€ä¸ªç»„ä»¶çŠ¶æ€çš„å˜åŒ–ç„¶åæ›´æ–°å½“å‰çš„è¿™ä¸ªç»„ä»¶ã€‚

å› æ­¤å¯ä»¥ç”¨ `React.memo` ç¼“å­˜ç»„ä»¶ï¼Œè¿™æ ·åªæœ‰ä¼ å…¥å½“å‰ç»„ä»¶çŠ¶æ€å€¼å˜åŒ–æ—¶æ‰ä¼šé‡æ–°æ¸²æŸ“ï¼Œå€¼ç›¸åŒé‚£ä¹ˆå°±ä¼šç¼“å­˜ç»„ä»¶ã€‚

```tsx
// å­ç»„ä»¶
const Child = React.memo(() => {
  console.log("child");
  return <div>Child</div>;
});

// çˆ¶ç»„ä»¶
function App() {
  const [count, setCount] = useState(0);
  return (
    <div className="App">
      <h3>{count}</h3>
      <button onClick={() => setCount(count + 1)}>Count++ </button>
      <Child />
    </div>
  );
}
```

ä¸Šé¢ä»£ç  `<Child />` ç»„ä»¶æ·»åŠ ä¸Š `memo` æ¯æ¬¡ç‚¹å‡» count ++ é‚£ä¹ˆå°±ä¼šä¸ä¼šé‡æ–°æ¸²æŸ“äº†ã€‚

## React.useCallback è®©å‡½æ•°ä¿æŒç›¸åŒçš„å¼•ç”¨

åƒä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœçˆ¶ç»„ä»¶æƒ³æ‹¿åˆ°å­ç»„ä»¶çš„çŠ¶æ€å€¼ï¼Œé€šå¸¸ä¼šä½¿ç”¨ callback çš„æ–¹å¼ä¼ é€’å‡ºå»ç»™çˆ¶ç»„ä»¶ã€‚

```tsx
interface ChildProps {
  onChangeNum: (value: number) => void;
}

const Child: React.FC<ChildProps> = React.memo(({ onChangeNum }) => {
  console.log("child");
  const [num, setNum] = useState(0);
  useEffect(() => {
    onChangeNum(num);
  }, [num]);
  return (
    <div>
      <button
        onClick={() => {
          setNum((prevState) => {
            return prevState + 1;
          });
        }}
      >
        Child
      </button>
    </div>
  );
});

function App() {
  const [count, setCount] = useState(0);
  return (
    <div className="App">
      <h3>{count}</h3>
      <button onClick={() => setCount(count + 1)}>Count++ </button>
      <Child
        onChangeNum={(num) => {
          console.log(num, "childNum");
        }}
      />
    </div>
  );
}
```

ç»„ä»¶æ¯æ¬¡æ›´æ–° num å€¼ï¼Œçˆ¶ç»„ä»¶é€šè¿‡ onChangeNum å›æ‰å‡½æ•°æ–¹å¼æ¥å—ã€‚

æ³¨æ„åˆšæ‰è¯´çš„ `memo` èƒ½å¤Ÿåœ¨ç»„ä»¶ä¼ å…¥å€¼ä¸å˜çš„æƒ…å†µä¸‹ç¼“å­˜ç»„ä»¶é¿å…é‡æ–°æ¸²æŸ“ï¼Œä½†æ˜¯ï¼Œè¿™é‡Œåˆå¤±æ•ˆäº†ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

åŸå› å°±æ˜¯çˆ¶ç»„ä»¶æ›´æ–°äº†ï¼Œæ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ onChangeNum ï¼Œç›¸å½“äºå±äºä¸åŒçš„å¼•ç”¨äº†ï¼Œåœ¨æ¯æ¬¡ props ä¼ é€’çš„å›æ‰å‡½æ•°éƒ½ä¸ç›¸åŒï¼Œæ‰€ä»¥ memo å¤±å»äº†ä½œç”¨ã€‚

é‚£ä¹ˆè¯¥æ€ä¹ˆè§£å†³ï¼Ÿé‚£å°±æ˜¯ä½¿ç”¨ `useCallback` hook å¸®åŠ©æˆ‘ä»¬ä¿æŒç›¸åŒçš„å¼•ç”¨ã€‚

```tsx
<Child
  onChangeNum={useCallback((num) => {
    console.log(num, "childNum");
  }, [])}
/>
```

å¼€å‘ä¸­ä½¿ç”¨äº† `memo` ç¼“å­˜äº†ç»„ä»¶ï¼Œè¿˜éœ€è¦æ³¨æ„æ˜¯å¦æœ‰åŒ¿åå‡½æ•°ä¼ é€’ç»™å­ç»„ä»¶ã€‚

å¹¶ä¸ä¸€å®šåªåœ¨è¿™ç§æƒ…å†µä¸‹æ‰ä½¿ç”¨ useCallback ï¼Œæ¯”å¦‚ä¸€ä¸ªè¯·æ±‚å‡½æ•°æˆ–è€…é€»è¾‘å¤„ç†å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨ useCallback åŒ…è£¹ï¼Œ**ä¸è¿‡è¦æ³¨æ„ï¼Œå†…éƒ¨å¼•ç”¨äº†å¤–éƒ¨çš„çŠ¶æ€æˆ–è€…å€¼çš„ç›¸å…³è”ï¼Œé‚£ä¹ˆéœ€è¦åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå°±æ˜¯ä¾èµ–æ•°ç»„é‡Œé¢æ·»åŠ ä¸Šç”¨åˆ°çš„æŸäº›å€¼ã€‚**

## é¿å…ä½¿ç”¨å†…è”å¯¹è±¡

åœ¨ä½¿ç”¨å†…è”å¯¹è±¡ï¼Œreact æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶ä¼šé‡æ–°åˆ›å»ºæ­¤å¯¹è±¡ï¼Œåœ¨æ›´æ–°ç»„ä»¶å¯¹æ¯” props ï¼Œ`oldProps === newProps` åªè¦ä¸º `false` é‚£ä¹ˆå°±ä¼š `re-render` ã€‚

å¦‚æœ`TestComponent` ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œé‚£ä¹ˆå°±ä¼šæ–°å»ºåˆ›å»º someProps å¼•ç”¨ã€‚ä¼ é€’ç»™ `RootComponent` ç»„ä»¶æ¯æ¬¡åˆ¤æ–­æ–°æ—§ props ç»“æœä¸åŒï¼Œå¯¼è‡´ä¹Ÿé‡æ–°æ¸²æŸ“ã€‚

```tsx
const TestComponent = () => {
  const someProps = { value: "1" };
  return <RootComponent someProps={someProps} />;
};
```

æ›´å¥½çš„æ–¹å¼æ˜¯ï¼Œä½¿ç”¨ ES6 æ‰©å±•è¿ç®—ç¬¦çš„å°†è¿™ä¸ªå¯¹è±¡å±•å¼€ï¼Œå¼•ç”¨ç±»å‹å˜ä¸ºå€¼ç±»å‹ä¼ é€’ï¼Œè¿™æ ·å†å¯¹æ¯” props å°±ä¼šç›¸ç­‰äº†ã€‚

```tsx
const TestComponent = () => {
  const someProps = { value: "1" };
  return <RootComponent {...someProps} />;
};
```

## ä½¿ç”¨ React.useMemo ç¼“å­˜è®¡ç®—ç»“æœæˆ–è€…ç»„ä»¶

å¦‚ React æ–‡æ¡£æ‰€è¯´ï¼Œ`useMemo` çš„åŸºæœ¬ä½œç”¨æ˜¯ï¼Œé¿å…æ¯æ¬¡æ¸²æŸ“éƒ½è¿›è¡Œé«˜å¼€é”€çš„è®¡ç®—ã€‚

å¦‚æœæ˜¯ä¸€ä¸ªåŠŸèƒ½ç»„ä»¶é‡Œé¢ï¼Œæ¶‰åŠåˆ°å¤§å‹çš„è®¡ç®—ï¼Œç»„ä»¶æ¯æ¬¡é‡æ–°æ¸²æŸ“å¯¼è‡´éƒ½ä»æ–°è°ƒç”¨å¤§å‹çš„è®¡ç®—å‡½æ•°ï¼Œè¿™æ˜¯éå¸¸æ¶ˆè€—æ€§èƒ½çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `useMemo` æ¥ç¼“å­˜è¿™ä¸ªå‡½æ•°çš„è®¡ç®—ç»“æœï¼Œæ¥å‡å°‘ JavaScript åœ¨å‘ˆç°ç»„ä»¶æœŸé—´å¿…é¡»æ‰§è¡Œçš„å·¥ä½œé‡ï¼Œæ¥ç¼©çŸ­é˜»å¡ä¸»çº¿ç¨‹çš„æ—¶é—´ã€‚

```tsx
// åªæœ‰å½“ id å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰ä¼šä»æ–°è®¡ç®—
const TestComponent = () => {
  const value = useMemo(() => {
    return expensiveCalculation();
  }, [id]);
  return <Component countValue={value} />;
};
```

åœ¨ä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—ç»“æœä¹‹å‰ï¼Œè¿˜éœ€è¦åœ¨é€‚å½“çš„åœ°æ–¹åº”ç”¨ï¼ŒuseMemo ä¹Ÿæ˜¯æœ‰æˆæœ¬çš„ï¼Œå®ƒä¹Ÿä¼šå¢åŠ æ•´ä½“ç¨‹åºåˆå§‹åŒ–çš„è€—æ—¶ï¼Œé™¤éè¿™ä¸ªè®¡ç®—çœŸçš„å¾ˆæ˜‚è´µï¼Œæ¯”å¦‚é˜¶ä¹˜è®¡ç®—ã€‚

æ‰€ä»¥å¹¶ä¸é€‚åˆå…¨å±€ä½¿ç”¨ï¼Œå®ƒæ›´é€‚åˆåšå±€éƒ¨çš„ä¼˜åŒ–ã€‚**ä¸åº”è¯¥è¿‡åº¦ useMemoã€‚**

å¦å¤–åœ¨ç¼“å­˜ç»“æœå€¼çš„åŒæ—¶ï¼Œè¿˜å¯ä»¥ç”¨æ¥ç¼“å­˜ç»„ä»¶ã€‚

æ¯”å¦‚æœ‰ä¸€ä¸ªå…¨å±€ `context` ï¼Œéšç€é•¿æœŸé¡¹ç›®è¿­ä»£ context é‡Œé¢å¡äº†å¾ˆå¤šçŠ¶æ€ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œcontext çš„ value å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šå¯¼è‡´ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œè€Œè¿™ä¸ªç»„ä»¶æ—¶ä¸€ä¸ªå¾ˆæ¶ˆè€—æ€§èƒ½çš„å¤§å‹ç»„ä»¶ï¼Œåªä¼šè¢«å…¶ä¸­ä¸€ä¸ªå˜é‡æ‰€å½±å“æ‰é‡æ–°æ¸²æŸ“ï¼Œè¿™æ—¶å€™å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ useMemo è¿›è¡Œç¼“å­˜ã€‚

```tsx
const TestComponent = () => {
  const appContextValue = useContext(AppContext);
  const theme = appContextValue.theme;

  return useMemo(() => {
    return <RootComponent className={theme} />;
  }, [theme]);
};
```

`<RootComponent />` åªæœ‰åœ¨ `theme` å˜é‡å‘ç”Ÿå˜åŒ–çš„æ—¶å€™é‡æ–°æ¸²æŸ“ã€‚

## ä½¿ç”¨ **React.Fragment ç‰‡æ®µ**

react æœ‰è§„å®šç»„ä»¶ä¸­å¿…é¡»æœ‰ä¸€ä¸ªçˆ¶å…ƒç´ ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ ¹æ ‡ç­¾ä¸éœ€è¦ä»»ä½•çš„å±æ€§ï¼Œè¿™ä¼šå¯¼è‡´æ•´ä¸ªåº”ç”¨ç¨‹åºå†…åˆ›å»ºè®¸å¤šæ— ç”¨çš„å…ƒç´ ï¼Œé‚£ä¹ˆè¿™ä¸ªæ ‡ç­¾çš„ä½œç”¨å¹¶æ²¡æœ‰å¤ªå¤§çš„æ„ä¹‰ã€‚

```tsx
const TestComponent = () => {
  return (
    <div>
      <ChildA />
      <ChildB />
      <ChildC />
    </div>
  );
};
```

å®é™…ä¸Šé¡µé¢ä¸Šçš„å…ƒç´ è¶Šå¤šï¼ŒDOM ç»“æ„åµŒå¥—è¶Šæ·±ï¼ŒåŠ è½½æ‰€éœ€çš„æ—¶é—´å°±è¶Šå¤šï¼Œä¹Ÿä¼šå¢åŠ æµè§ˆå™¨çš„æ¸²æŸ“å‹åŠ›ã€‚

å› æ­¤ React æä¾›äº† `Fragment` ç»„ä»¶æ¥ä»£æ›¿åŒ…è£¹å¤–å±‚ï¼Œå®ƒä¸ä¼šå¸®æˆ‘ä»¬é¢å¤–çš„åˆ›å»ºå¤–å±‚ `div` æ ‡ç­¾ã€‚

```tsx
const TestComponent = () => {
  return (
    <React.Fragment>
      <ChildA />
      <ChildB />
      <ChildC />
    </React.Fragment>
  );
};
```

æˆ–è€…å¦ä¸€ç§ç®€æ´çš„æ–¹å¼ä½¿ç”¨ç©ºæ ‡ç­¾ `<></>` ä»£æ›¿ä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœï¼š

```tsx
const TestComponent = () => {
  return (
    <>
      <ChildA />
      <ChildB />
      <ChildC />
    </>
  );
};
```

å¦å¤–è¿˜æœ‰ä¸€äº›å®ç”¨çš„åœºæ™¯ï¼Œæ ¹æ®æ¡ä»¶æ¸²æŸ“å…ƒç´ 

```tsx
const TestComponent = () => {
  const { isLogin, name } = useApp();
  return (
    <>
      {isLogin ? (
        <>
          <h3>Welcome {name}</h3>
          <p>You are logged in!</p>
        </>
      ) : (
        <h3>go login...</h3>
      )}
    </>
  );
};
```

## \***\*ç»„ä»¶æ‡’åŠ è½½\*\***

åº”ç”¨ç¨‹åºåˆå§‹åŒ–åŠ è½½çš„å¿«æ…¢ä¹Ÿè·Ÿç»„ä»¶çš„æ•°é‡æœ‰å…³ï¼Œå› æ­¤åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¸€äº›æˆ‘ä»¬çœ‹ä¸è§çš„é¡µé¢ï¼Œä¹Ÿå°±æ˜¯æœ€å¼€å§‹ç”¨ä¸åˆ°çš„ç»„ä»¶å¯ä»¥é€‰æ‹©å»¶è¿ŸåŠ è½½ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°çš„æ˜¯è·¯ç”±çš„æ‡’åŠ è½½ï¼Œè¿™æ ·æ¥æå‡é¡µé¢çš„åŠ è½½é€Ÿåº¦å’Œå“åº”æ—¶é—´ã€‚

react æä¾›äº† `React.Lazy` å’Œ `React.Suspense` æ¥å¸®æˆ‘ä»¬å®ç°ç»„ä»¶çš„æ‡’åŠ è½½ã€‚

```tsx
import React, { lazy, Suspense } from "react";

const AvatarComponent = lazy(() => import("./AvatarComponent"));

const renderLoader = () => <p>Loading</p>;

const DetailsComponent = () => (
  <Suspense fallback={renderLoader()}>
    <AvatarComponent />
  </Suspense>
);
```

`Suspense` ä½œç”¨å°±æ˜¯å¼¥è¡¥åœ¨ `Lazy` ç»„ä»¶åŠ è½½å®Œæˆä¹‹å‰è¿™æ®µç©ºç™½æ—¶é—´æ‰€èƒ½åšçš„äº‹æƒ…ï¼Œå°¤å…¶åœ¨ç»„ä»¶è¾ƒå¤§ï¼Œæˆ–è€…åœ¨è¾ƒå¼±çš„è®¾å¤‡å’Œç½‘ç»œä¸­ï¼Œå°±å¯ä»¥é€šè¿‡ `fallback` å±æ€§æ·»åŠ ä¸€ä¸ª loading æç¤ºç”¨æˆ·æ­£åœ¨åŠ è½½çš„çŠ¶æ€ã€‚å¼‚æ­¥ç»„ä»¶åŠ è½½å®Œæˆä¹‹åå°±ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚

å¦‚æœå•ç‹¬ä½¿ç”¨ `lazy` React ä¼šåœ¨æ§åˆ¶å°å‘å‡ºé”™è¯¯æç¤ºï¼

## é€šè¿‡ CSS **åŠ è½½å’Œå¸è½½ç»„ä»¶**

æ¸²æŸ“æ˜¯æ˜‚è´µçš„ï¼Œå¦‚æœé¢‘ç¹åŠ è½½/å¸è½½â€˜å¾ˆé‡â€™çš„ç»„ä»¶ï¼Œè¿™ä¸ªæ“ä½œå¯èƒ½éå¸¸æ¶ˆè€—æ€§èƒ½æˆ–è€…å¯¼è‡´å»¶è¿Ÿã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šç”¨ä¸‰å…ƒè¿ç®—ç¬¦åœ¨åˆ¤æ–­åŠ è½½æ˜¾ç¤ºï¼Œä¹Ÿå¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼Œæ¯æ¬¡é¢‘ç¹æ›´æ–°ï¼Œè§¦å‘åŠ è½½ä¸åŒçš„ç»„ä»¶ï¼Œå°±ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½æŸè€—ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CSS å±æ€§å°†å…¶éšè—ï¼Œè®© DOM èƒ½å¤Ÿä¿ç•™åœ¨é¡µé¢å½“é‡ã€‚

**ä¸è¿‡è¿™ç§æ–¹å¼å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›å¸ƒå±€æˆ–è€…çª—å£å‘ç”Ÿé”™ä½çš„é—®é¢˜ã€‚**ä½†æˆ‘ä»¬åº”è¯¥é€‰æ‹©åœ¨ä¸æ˜¯è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨è°ƒæ•´ CSS çš„æ–¹æ³•ã€‚å¦å¤–ä¸€ç‚¹ï¼Œå°†ä¸é€æ˜åº¦è°ƒæ•´ä¸º 0 å¯¹æµè§ˆå™¨çš„æˆæœ¬æ¶ˆè€—å‡ ä¹ä¸º 0ï¼ˆå› ä¸ºå®ƒä¸ä¼šå¯¼è‡´é‡æ’ï¼‰ï¼Œå¹¶ä¸”åº”å°½å¯èƒ½ä¼˜å…ˆäºæ›´è¯¥ visibility å’Œ displayã€‚

```tsx
// é¿å…å¯¹å¤§å‹çš„ç»„ä»¶é¢‘ç¹å¯¹åŠ è½½å’Œå¸è½½
const ViewExample = () => {
  const [isTest, setIsTest] = useState(true)
  return (
    <>
      { isTest ? <ViewComponent /> : <TestComponent />}
    </>
  );
};

// ä½¿ç”¨è¯¥æ–¹å¼æå‡æ€§èƒ½å’Œé€Ÿåº¦
const visibleStyles = { opacity: 1 };
const hiddenStyles = { opacity: 0 };
const ViewExample = () => {
  const [isTest, setIsTest] = useState(true)
  return (
    <>
      <ViewComponent style={!isTest ? visibleStyles : hiddenStyles} />
			<TestComponent style={{ isTest ? visibleStyles : hiddenStyles }} />
    </>
  );
};
```

## å˜ä¸ä¸å˜çš„åœ°æ–¹åšåˆ†ç¦»

é€šå¸¸ä½¿ç”¨ useMemoã€useCallback è¿›è¡Œä¼˜åŒ–ï¼Œè¿™é‡Œè¯´è¯´ä¸å€ŸåŠ©è¿™äº› Hooks è¿›è¡Œä¼˜åŒ–ï¼Œ

å˜ä¸ä¸å˜åšåˆ†ç¦»çš„æ¦‚å¿µæ¥æºï¼Œå…¶å®å°±æ˜¯å› ä¸ºè‡ªèº«çš„ react çš„æœºåˆ¶ï¼Œçˆ¶ç»„ä»¶çš„çŠ¶æ€æ›´æ–°äº†ï¼Œæ‰€æœ‰çš„å­ç»„ä»¶å¾—è·Ÿç€ä¸€èµ·æ¸²æŸ“ï¼Œæ„æ€æ˜¯å°†**æœ‰çŠ¶æ€çš„ç»„ä»¶å’Œæ— çŠ¶æ€çš„ç»„ä»¶åˆ†ç¦»å¼€ã€‚**

```tsx
function ExpensiveCpn() {
  console.log("ExpensiveCpn");
  let now = performance.now();
  while (performance.now() - now < 100) {}
  return <p>è€—æ—¶çš„ç»„ä»¶</p>;
}

export default function App() {
  const [num, updateNum] = useState("");
  return (
    <>
      <input
        type="text"
        onChange={(e) => updateNum(e.target.value)}
        value={num}
      />
      <ExpensiveCpn />
    </>
  );
}
```

ä¸Šé¢è¾“å…¥æ¡†è¾“å…¥éƒ½ä¼šåˆ·æ–°ç»„ä»¶<`ExpensiveCpn`/>ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ä½¿ç”¨ useMemo ç­‰ API å°±èƒ½æ§åˆ¶æ¸²æŸ“å…¶å®å°±æ˜¯å°†å˜å¾—å’Œä¸å˜çš„åˆ†ç¦»å¼€ ğŸ‘‡ğŸ»ï¼š

```tsx
function ExpensiveCpn() {
  console.log("ExpensiveCpn");
  let now = performance.now();
  while (performance.now() - now < 100) {}
  return <p>è€—æ—¶çš„ç»„ä»¶</p>;
}

function Input() {
  const [num, updateNum] = useState("");
  return (
    <input
      type="text"
      onChange={(e) => updateNum(e.target.value)}
      value={num}
    />
  );
}
export default function App() {
  return (
    <>
      <Input />
      <ExpensiveCpn />
    </>
  );
}
```

è¿™æ ·æ¸²æŸ“çš„ç»„ä»¶åªä¼šæ˜¯ `<Input/>`ç»„ä»¶å†…éƒ¨ï¼Œä¸ä¼šå½±å“åˆ°å¤–éƒ¨ã€‚

## æ€»ç»“

ä¸Šé¢ä¸€äº›æ–¹å¼ï¼Œå¯ä»¥ä»å‡ ä¸ªæ–¹é¢ç†è§£ï¼š

- å‡å°‘é‡æ–° render çš„æ¬¡æ•°ï¼šmemoã€useMemoã€useCallback ä½¿ç”¨ã€é¿å…ä½¿ç”¨å†…è”å¯¹è±¡ã€å˜ä¸ä¸å˜çš„åˆ†ç¦»ã€‚
- å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ï¼šReact.Fragment ç‰‡æ®µã€ç»„ä»¶æ‡’åŠ è½½ã€‚
- é™ä½æ¸²æŸ“è®¡ç®—é‡ï¼šéå†è¯•å›¾ä½¿ç”¨ keyã€‚
